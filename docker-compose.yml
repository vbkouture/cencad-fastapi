services:
    api:
        build: .
        ports:
            - "8080:8080"
        env_file:
            - .env
        depends_on:
            mongo:
                condition: service_healthy
        environment:
            MONGODB_URL: mongodb://appdb:27017
            MONGODB_DB: appdb
    mongo:
        image: mongo:7.0
        container_name: fastapi-mongo-local
        ports:
            - "27017:27017"
        environment:
            MONGO_INITDB_DATABASE: appdb
        volumes:
            - mongo_data:/data/db
        healthcheck:
            test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
            interval: 10s
            timeout: 5s
            retries: 5
            start_period: 10s

volumes:
    mongo_data:
        name: fastapi_mongo_data
